# 开发计划

## 前端

1. **基础架构搭建**
   - 初始化 Vite + Vue 3 项目结构。
   - 配置 Vue Router 与 Pinia，创建基础 Store 模块骨架。
   - 设置环境变量加载机制，区分开发与生产配置。

2. **页面骨架实现**
   - 完成 `Home`、`CreateItinerary`、`ItineraryList` 页的静态布局与路由跳转。
   - 统一导航栏、侧边栏、布局容器组件，保证主流程可浏览。

3. **核心业务流程打通**
   - 实现行程创建表单与提交逻辑，连接后端 LLM 生成接口。
   - 构建 `ItineraryDetail` 页面数据结构，展示生成结果与地图占位。

4. **数据持久化集成**
   - 接入 Supabase 或后端 API，实现行程列表、详情保存与更新。
   - 建立费用数据的增删改查流程，确保前后端同步。

5. **语音与地图功能接入**
   - 集成科大讯飞语音识别，打通录音、转写与提交到业务流程。
   - 接入高德地图，完成 POI 标记与时间线联动。

6. **扩展功能与优化**
   - 实现费用中心图表、账号登录流程与错误降级处理。
   - 进行响应式适配、交互微调与体验优化，准备发布。

## 后端

1. **项目初始化与配置**
   - 建立 FastAPI 项目骨架，配置 Poetry 或 pip requirements 管理依赖。
   - 设置分层目录结构（api/core/schemas/services），并加载环境变量与日志系统。

2. **数据库与 Supabase 集成**
   - 定义核心数据模型（用户、行程、费用、地点），对接 Supabase/PostgreSQL。
   - 实现基础 CRUD 服务与仓储层，完成数据库迁移或初始化脚本。

3. **认证与用户管理**
   - 接入 Supabase Auth 或自建 JWT 认证流程，暴露注册、登录、Token 刷新接口。
   - 设置统一鉴权依赖，保护需要登录的 API。

4. **行程与费用 API**
   - 实现行程创建、更新、获取、删除接口，集成 LLM 生成逻辑。
   - 实现费用记录 CRUD 及预算汇总接口，输出统计数据供前端图表使用。

5. **外部服务对接**
   - 封装高德地图查询与路线规划服务，提供地点搜索与路线接口。
   - 集成阿里云百炼或其他 LLM API，设计 Prompt 模板与结果校验流程。
   - 对接科大讯飞语音识别回调或轮询逻辑，统一语音处理接口。

6. **测试与可靠性**
   - 编写单元测试和集成测试，覆盖服务层与关键 API。
   - 针对外部依赖编写降级方案和模拟数据，确保接口在失败时可返回友好提示。

7. **部署与运维**
   - 配置 Dockerfile、docker-compose，确保本地与部署环境一致性。
   - 若使用 CI/CD（如 GitHub Actions），增加测试与镜像打包流程。
   - 编写运行与环境配置文档，便于课程验收。

## 整体计划

1. **准备阶段**
   - 目标：统一需求理解，确保所有基础设施与凭据准备就绪。
   - 关键交付：需求对照表、环境搭建指南、凭据登记表。
   - 关键动作：梳理课程验收标准与功能优先级；统计所需 API Key/Supabase 表结构；搭建 Python 虚拟环境、Node.js 工具链与 Docker 基础镜像；检查 README/开发指南完整性。

2. **智能行程规划**
   - 目标：支持语音/文字输入，生成包含交通、住宿、景点、餐厅的 AI 行程方案。
   - 关键交付：语音上传与识别接口、行程生成 API、前端行程创建与详情页面演示。
   - 关键动作：在前端实现语音录制并调用后端语音识别（提供文字改写 fallback）；完善行程创建表单与语音触发逻辑；后端封装 LLM Prompt 与返回结构，落地行程生成服务；在详情页展示日程、预算与推荐信息。

   2.1 后端：语音上传接口与科大讯飞 SDK 封装占位、文字输入的 LLM prompt 生成服务、行程生成 API。
   2.2 前端：语音录制组件（含回退文字输入）、行程创建页调用语音/文字接口并展示生成结果。
   2.3 数据流：行程详情页展示结构化日程、预算信息及推荐，并与后端结果字段对齐

3. **费用预算与管理**
   - 目标：由 AI 输出预算建议，并支持语音/文字记账与费用概览。
   - 关键交付：费用创建接口、预算分析 API、前端费用录入与看板。
   - 关键动作：基于行程结果生成预算拆分，并在后端提供预算估算端点；构建费用 CRUD 与语音录入通道；前端 Expense 页面展示分类统计、预算对比与语音记账入口。

   3.1 后端：预算分析端点（基于行程拆分估算）、费用 CRUD 与语音记账入口、总结统计接口。
   3.2 前端：费用录入表单与语音记账面板、预算对比与分类统计视图、Pinia 状态同步。
   3.3 自动化：基础集成测试或 mock 验证预算/费用接口

4. **地图 UI 显示**
   - 目标：在创建行程与行程详情页面提供清晰的空间视图，帮助用户理解路线与地点分布。
   - 关键交付：左右布局调整方案、高德地图嵌入组件、行程目的地气泡标注。
   - 关键动作：将信息栏移动至页面左侧，右侧以高德地图 API 显示对应城市；根据行程数据渲染目的地与每日停靠点的气泡/标注，并确保与日程、预算信息联动更新。

   4.1 前端：
      - 调整 `CreateItinerary` 与 `ItineraryDetail` 布局为左右分栏，左侧展示表单/详情，右侧插入地图容器组件。
      - 引入并封装高德地图 JS SDK，完成地图初始化、城市定位、目的地气泡渲染与交互提示。
      - 结合 Pinia/Store 的行程数据，在页面生命周期中同步更新地图标注，并处理无坐标或定位失败的回退 UI。

   4.2 后端：
      - 在行程生成流程中为每日活动补充坐标或地点标识（如名称、POI ID），必要时调用高德地理编码服务。
      - 在 `ItineraryResponse` 中确保返回的地点信息结构化（包含名称、经纬度、说明），供前端直接消费。
      - 若调用外部地图服务，需要配置缓存或重试策略，并暴露相关配置项（API Key、限频警告）。

   4.3 集成测试与验收：
      - 编写前端端到端用例验证多日行程的气泡展示、点击联动与布局适配。
      - 模拟后端地点缺失、API 调用失败等场景，确认前端能显示合理的提示或降级地图。
      - 收集真实行程样例校验地图精度与体验，整理验收清单。

5. **用户管理与数据存储**
   - 目标：实现注册/登录、行程与费用云端同步，可多设备访问。
   - 关键交付：Supabase 数据模型与迁移脚本、认证模块、前端用户态管理。
   - 关键动作：设计行程、费用、偏好相关表结构并同步 Supabase；接入 Supabase Auth 或 JWT，前端实现注册/登录/登出流；所有行程、费用、偏好接口加上鉴权校验，确保数据按用户隔离，支持多终端同步。

   5.1 数据层：Supabase 表结构与迁移脚本、仓储层权限校验。
   5.2 认证：注册/登录/Token 刷新 API、前端登录态管理与路由守卫。
   5.3 同步：行程/费用/偏好 API 全面接入鉴权，确保按用户隔离且多端同步。

6. **外部服务集成**
   - 目标：稳定接入 LLM、地图、语音等第三方服务，提供降级能力。
   - 关键交付：可配置的第三方服务适配器、地图展示模块、语音交互文档。
   - 关键动作：调优 LLM 请求与结果校验，封装高德地图路线与地点搜索并在前端嵌入地图视图；完善科大讯飞语音识别接入、支持离线或文本回退模式；记录配置项与故障降级策略。

7. **质量保障**
   - 目标：建立可持续演进的测试与观测体系。
   - 关键交付：单元/集成/端到端测试套件、覆盖率报告、日志与错误上报方案。
   - 关键动作：扩充后端服务与前端组件单测；编写端到端冒烟脚本验证核心用户旅程；设置 logging/监控指标、错误提示与异常处理策略；将测试结果纳入 CI 基线。

8. **发布与运维**
   - 目标：保证上线流程可复现、可回滚，并有完善的运维支持材料。
   - 关键交付：Docker 镜像与 docker-compose 配置、CI/CD 流水线、上线/运维手册。
   - 关键动作：优化后端与前端 Dockerfile，统一环境变量管理；搭建 CI/CD 执行测试、构建、镜像推送与部署；整理部署步骤、常见问题、故障恢复流程供课程验收使用。
